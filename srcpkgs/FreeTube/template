# Template file for 'FreeTube'
pkgname=FreeTube
version=0.18.0
revision=1
wrksrc="${pkgname}-${version}-beta"
hostmakedepends="git nodejs yarn"
depends="electron19 gtk+3 nss"
short_desc="Open source desktop YouTube player built with privacy in mind"
maintainer="Chloris <chloris@freedommail.ch>"
license="AGPL-3.0-or-later"
homepage="https://freetubeapp.io/"
changelog="https://github.com/FreeTubeApp/FreeTube/releases"
distfiles="https://github.com/FreeTubeApp/FreeTube/archive/refs/tags/v${version}-beta.tar.gz"
checksum=6db8d81453e3caa5e304e1dca534b26669d6ac863e78189b19f6771dfbf9f631

do_build() {
	yarn --cache-folder './yarn-cache' install
	npm --cache './npm-cache' run build
}

do_install() {
	vmkdir "usr/lib/${pkgname}"
	vinstall 'build/linux-unpacked/resources/app.asar' 644 "usr/lib/${pkgname}"

	vdoc 'README.md'
	vlicense 'LICENSE'

	vinstall '_icons/icon.svg' 644 'usr/share/pixmaps' "${pkgname}.svg"
	vinstall "${FILESDIR}/${pkgname}.desktop" 644 'usr/share/applications'
	vbin "${FILESDIR}/${pkgname}.sh" "${pkgname}"
}

#
# BUILD PROCESS NOTE
#
# npm will try to either download Electron or copy local Electron into into the
# build dir. Since one of the patches directs it to use an unexistent local
# installation of Electron, the 'copying Electron' step will fail with error
# 'Error: ENOENT: no such file or directory'.
#
# This error can be safely ignored - the only needed product of the build
# process is 'app.asar'. Once installed, system installation of Electron will
# be used to run the app.
#

#
# DEPENDENCIES NOTE
#
# npm packages the app with Electron 16 by default. This version is not
# available in Void repos, so the package uses Electron 19 instead.
#
