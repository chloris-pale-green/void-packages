# Template file for 'devilutionX'
pkgname=devilutionX
version=1.4.1
revision=1
build_style=cmake
configure_args="-DVERSION_NUM=$version -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTING=OFF"
hostmakedepends="gettext git mpqtool pkgconf"
makedepends="bzip2-devel fmt-devel libsodium-devel SDL2-devel SDL2_image-devel SDL2_mixer-devel zlib-devel"
short_desc="Diablo I engine for modern operating systems"
maintainer="MarcoAPC <marcoaureliopc@gmail.com>"
license="Unlicense"
homepage="https://github.com/diasurgical/devilutionX"
distfiles="https://github.com/diasurgical/devilutionX/archive/${version}.tar.gz"
checksum=54b9fd496eba5b82d7e64891ab4de808f539c60b3b94bfa49639e0d9580fb7b8

post_build() {
	# Create devilutionx.mpq asset archive
	# (smpq, required by the build script, is not available in Void repos
	# so an alternative program mpqtool is used to create the MPQ archive)
	mpqtool new 'build/assets' 'build/devilutionx.mpq'
}

do_install() {
	vbin 'build/devilutionx'
	# Install assets to the directory that is recognized by the binary
	vinstall 'build/devilutionx.mpq' 644 'usr/share/diasurgical/devilutionx'

	vdoc 'README.md'
	vlicense 'LICENSE'

	cd 'Packaging'
	# Install desktop entries
	vinstall 'nix/devilutionx.desktop' 644 'usr/share/applications'
	vinstall 'nix/devilutionx-hellfire.desktop' 644 'usr/share/applications'
	# Install icons
	vinstall 'resources/icon.png' 644 \
		'usr/share/icons/hicolor/512x512/apps' 'devilutionx.png'
	vinstall 'resources/hellfire.png' 644 \
		'usr/share/icons/hicolor/512x512/apps' 'devilutionx-hellfire.png'
	vinstall 'resources/icon_32.png' 644 \
		'usr/share/icons/hicolor/32x32/apps' 'devilutionx.png'
	vinstall 'resources/hellfire_32.png' 644 \
		'usr/share/icons/hicolor/32x32/apps' 'devilutionx-hellfire.png'
}
